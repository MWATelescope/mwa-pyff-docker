- when edugain_whitelist:
    - xslt:
        stylesheet: edugain_whitelist.xsl
    - break
- when aaf_whitelist:
    - xslt:
        stylesheet: aaf_whitelist.xsl
    - break
- when update:
    - load:
        - unitedid-metadata.xml
        - aaf_prod.xrd as aaf_prod via aaf_whitelist
        - aaf_edugain.xrd as aaf_edugain via edugain_whitelist
        - scg-idp-metadata.xml
        - mwa-federation-metadata.xml
    - select as /mwa_discovery: 
        - https://proxy.mwatelescope.org/sp
        - https://idp2.anu.edu.au/idp/shibboleth
        - https://idpp1.curtin.edu.au/idp/shibboleth
        - https://aafidp2.csiro.au/idp/shibboleth
        - https://idp.unimelb.edu.au/idp/shibboleth
        - https://idp.cc.swin.edu.au/idp/shibboleth
        - https://federation.sydney.edu.au/idp/shibboleth
        - https://idp.uwa.edu.au/idp/shibboleth
        - https://idp.uws.edu.au/idp/shibboleth
        - urn:mace:incommon:asu.edu
        - https://sso.brown.edu/idp/shibboleth
        - urn:mace:incommon:berkeley.edu
        - https://idp.utorauth.utoronto.ca/shibboleth
        - urn:mace:incommon:washington.edu
        - https://idp.uwm.edu/idp/shibboleth
        - https://login.sphericalcowgroup.com/idp/shibboleth
        - https://idp.unitedid.org/idp/shibboleth
    - break
- when request:
    - select:
    - pipe:
        - when accept application/xml:
            - first
            - finalize:
                cacheDuration: PT12H
                validUntil: P10D
            - sign:
                key: metadata-signer.key
                cert: metadata-signer.crt
            - emit application/xml
            - break
        - when accept application/json:
            - xslt:
                stylesheet: discojson.xsl
            - emit application/json
            - break
